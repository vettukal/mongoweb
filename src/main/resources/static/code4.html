<!doctype html>
<!-- See http://www.firepad.io/docs/ for detailed embedding docs. -->
<html>
<head>
  <meta charset="utf-8" />
  <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <!-- CodeMirror and its JavaScript mode file -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/mode/javascript/javascript.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.2.0/codemirror.css" />

  <!-- Firepad -->
  <link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.3.0/firepad.css" />
  <script src="https://cdn.firebase.com/libs/firepad/1.3.0/firepad.min.js"></script>

  <style>
    html { height: 100%; }
    body { margin: 0; height: 100%; position: relative; }
    /* Height / width / positioning can be customized for your use case.
       For demo purposes, we make firepad fill the entire browser. */
    #firepad-container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="firepad-container"></div>

  <script>
    function init() {
      //// Initialize Firebase.
      var firepadRef = getExampleRef();
      // TODO: Replace above line with:
      // var firepadRef = new Firebase('<YOUR FIREBASE URL>');

      //// Create CodeMirror (with line numbers and the JavaScript mode).
     /*  var codeMirror = CodeMirror(document.getElementById('firepad-container'), {
        lineNumbers: true,
        mode: 'javascript'
      });

      //// Create Firepad.
      var firepad = Firepad.fromCodeMirror(firepadRef, codeMirror, {
        defaultText: '//link to the file on web: '+window.location+'\n //the default locationFirepad!\nfunction go() {\n  var message = "Hello, world.";\n %%USER_ID%%  console.log(message);\n}'
      }); */
    }

    // Helper to get hash from end of URL or generate a random one.
    
    // Steps to include params. 1. add var paramval to extract.
    // 2. Add /vince/+paramval your parameter value so it is accepted.
    //    Change the /vince/ in the spring boot also so that it accepts.
    // 3. Add param to /account?userid="+paramval+"&link="+ref.key()
    //		Change the java /accout/ to add the params inside the function. 
    
    function getExampleRef() {
      var ref = new Firebase('https://firepad.firebaseio-demo.com');
	  var paramval = getParameterByName('user');
	  console.log('extract user',paramval);
	  
	  var paramfaculty = getParameterByName('faculty');
	  console.log('extract faculty name: ',paramfaculty);
	  
	  var paramquizid = getParameterByName('quizid');
	  console.log('extract faculty name: ',paramquizid);
	
	  var paramsubject = getParameterByName('subject');
	  console.log('extract faculty name: ',paramsubject);
	  
	  var hash = window.location.hash.replace(/#/g, '');
// hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh	
	  $.getJSON("/vince/" + paramval+ "/" + paramfaculty + "/" + paramquizid + "/" + paramsubject, function(availability) {
        console.log('result from Spring boot',availability);
        
        if(availability.firstName){
        	console.log('first name is there',availability.firstName);
        	hash = availability.firstName;
        }
        else {
        	console.log('name is not there');
        }
         if (hash) {
            ref = ref.child(hash);
    		console.log('hash found, ref: ',ref);
          } else {
    	  console.log('push not happened,window loc: ',window.location);
            ref = ref.push(); // generate unique location.
    		console.log('ref value: ',ref.key());
            

    		//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    			  $.getJSON("/account?userid="+paramval+"&link="+ref.key()+"&faculty="+paramfaculty +"&quizid="+paramquizid +"&subject="+paramsubject, function(availability2) {
    		        console.log('result from Spring boot on saving the name, faculty and link',availability2);
    		        
    		        
    		        
    		    });
    			
    			
    		//>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    		
           
    		console.log('hash not found,window loc: ',window.location);
            window.location = window.location + '#' + ref.key(); // add it as a hash to the URL.
    		console.log('hash not fnd, window loc after push',window.location);
          }
          if (typeof console !== 'undefined')
            console.log('Firebase data: ', ref.toString());
          
          
          
          var firepadRef = ref;
          var codeMirror = CodeMirror(document.getElementById('firepad-container'), {
              lineNumbers: true,
              mode: 'javascript'
            });

            //// Create Firepad.
            var firepad = Firepad.fromCodeMirror(firepadRef, codeMirror, {
              defaultText: '\n \nfunction go() {\n  var message = "Hello, world.";\n %%USER_ID%%  console.log(message);\n}'
            });
            
            return ref;
        
    });
	
	
// hhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh
	  
      //var hash = window.location.hash.replace(/#/g, '');
	  //console.log('hash value:',hash);
	  //hash = "-KCCUonapMCqfx-Iwm-E";
	  
	 /*  if (hash) {
          ref = ref.child(hash);
  		console.log('hash found, ref: ',ref);
        } else {
  	  console.log('push not happened,window loc: ',window.location);
          ref = ref.push(); // generate unique location.
  		console.log('ref value: ',ref.key());
  		console.log('hash not found,window loc: ',window.location);
          window.location = window.location + '#' + ref.key(); // add it as a hash to the URL.
  		console.log('hash not fnd, window loc after push',window.location);
        }
        if (typeof console !== 'undefined')
          console.log('Firebase data: ', ref.toString()); */
        return ref;
      
    }
	
	
	function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
	}

    init();
  </script>
</body>
</html>
